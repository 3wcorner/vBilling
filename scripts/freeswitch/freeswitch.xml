<?xml version="1.0"?>
<document type="freeswitch/xml">
	<X-PRE-PROCESS cmd="set" data="domain=$${local_ip_v4}"/>
	<X-PRE-PROCESS cmd="set" data="domain_name=$${domain}"/>
	<X-PRE-PROCESS cmd="set" data="codecs=G729,PCMU,PCMA,GSM,G723"/>

	<!--
	vBilling Custom Defines
	-->
	<X-PRE-PROCESS cmd="set" data="freeswitch_config_server=http://localhost/vBilling/fs_Curl/index.php"/>
	<X-PRE-PROCESS cmd="set" data="freeswitch_binding=configuration"/>
	<X-PRE-PROCESS cmd="set" data="vBilling_API_host=127.0.0.1"/>
	<X-PRE-PROCESS cmd="set" data="vBilling_API_port=7665"/>
	<X-PRE-PROCESS cmd="set" data="vBilling_CDR=http://localhost/vBilling/POST/vBilling-cdr.php"/>
	<X-PRE-PROCESS cmd="set" data="event_socket_listen_ip=127.0.0.1"/>
	<X-PRE-PROCESS cmd="set" data="event_socket_listen_port=8021"/>
	<X-PRE-PROCESS cmd="set" data="event_socket_password=ClueCon"/>
	<!--
	vBilling Custom Defines
	-->

	<section name="configuration" description="Various Configuration">
		<configuration name="modules.conf" description="Modules">
			<modules>
				<load module="mod_console"/>
				<load module="mod_logfile"/>			    
				<load module="mod_xml_curl"/>
			</modules>
		</configuration>
		<configuration name="logfile.conf" description="File Logging">
			<settings>
				<param name="rotate-on-hup" value="true"/>
			</settings>
			<profiles>
				<profile name="debug">
					<settings>
						<param name="logfile" value="/home/vBilling/freeswitch/log/debug.log"/>
						<param name="rollover" value="26214400"/>
						<param name="uuid" value="true" />
					</settings>
					<mappings>
						<map name="all" value="debug,info,notice,warning,err,crit,alert"/>
					</mappings>
				</profile>
				<profile name="error">
					<settings>
						<param name="logfile" value="/home/vBilling/freeswitch/log/error.log"/>
						<param name="rollover" value="26214400"/>
						<param name="uuid" value="true" />
					</settings>
					<mappings>
						<map name="all" value="warning,err,crit,alert"/>
					</mappings>
				</profile>
				<profile name="sofia">
					<settings>
						<param name="logfile" value="/home/vBilling/freeswitch/log/sofia.log"/>
						<param name="rollover" value="10485760"/>
						<param name="uuid" value="true" />
					</settings>
					<mappings>
						<map name="mod_sofia.c" value="info,notice,warning,err,crit,alert"/>
						<map name="sofia.c" value="info,notice,warning,err,crit,alert"/>
						<map name="sofia_glue.c" value="info,notice,warning,err,crit,alert"/>
						<map name="sofia_reg.c" value="all"/>
						<map name="sofia_sla.c" value="info,notice,warning,err,crit,alert"/>
						<map name="sofia_presence.c" value="info,notice,warning,err,crit,alert"/>
					</mappings>
				</profile>
				<profile name="siptrace">
					<settings>
						<param name="logfile" value="/home/vBilling/freeswitch/log/siptrace.log"/>
						<param name="rollover" value="26214400"/>
						<param name="uuid" value="true" />
					</settings>
					<mappings>
						<map name="sofia.c" value="debug"/>
					</mappings>
				</profile>
			</profiles>
		</configuration>
		<configuration name="xml_curl.conf" description="cURL XML Gateway">
			<bindings>
				<binding name="production">
					<param name="gateway-url" value="$${freeswitch_config_server}" bindings="$${freeswitch_binding}"/>
				</binding>
			</bindings>
		</configuration>
	</section>
	<section name="dialplan" description="Regex/XML Dialplan">
		<context name="default">
			<extension name="api_unauthenticated">
				<condition field="destination_number" expression="^(\d+)$">
					<action application="socket" data="$${vBilling_API_host}:$${vBilling_API_port} async full"/>
				</condition>
			</extension>

			<extension name="api_authenticated">
				<condition field="destination_number" expression="^sip:(.*)$">
					<action application="socket" data="$${vBilling_API_host}:$${vBilling_API_port} async full"/>
				</condition>
			</extension>
		</context>
	</section>
</document>